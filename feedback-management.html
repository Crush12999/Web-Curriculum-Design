<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/global.css">
    <link rel="stylesheet" href="./images/icon/iconfont.css">
    <title>Document</title>
    <style>
        main {
            padding-top: 52px;
            width: 100%;
            background-color: #F2F2F2;
        }

        .container {
            width: 70%;
            height: 100%;
            margin: 0 auto;
        }


        /* @charset "utf-8"; */

        /* CSS Document */
        .tabtop15 {
            margin-top: 15px;
        }

        .tabtop15 td {
            background-color: #ffffff;
            height: 25px;
            line-height: 150%;
        }

        .font-center {
            text-align: center
        }

        .btbg {
            background: #e9faff !important;
        }

        .btbg1 {
            background: #f2fbfe !important;
        }

        .btbg2 {
            background: #f3f3f3 !important;
        }

        .biaoti {
            font-family: 微软雅黑;
            font-size: 26px;
            font-weight: bold;
            border-bottom: 1px dashed #CCCCCC;
            color: #255e95;
        }

        .titfont {
            font-family: 微软雅黑;
            font-size: 16px;
            font-weight: bold;
            color: #255e95;
            background-color: #e9faff;
        }

        .tabtxt2 {
            font-family: 微软雅黑;
            font-size: 14px;
            font-weight: bold;
            text-align: right;
            padding-right: 10px;
            color: #327cd1;
        }

        /* 文字链接 */
        .my-link {
            display: inline-flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            vertical-align: middle;
            position: relative;
            text-decoration: none;
            outline: none;
            cursor: pointer;
            padding: 0;
            font-size: 14px;
            font-weight: 500;
        }

        .my-link.my-link--danger {
            color: #f56c6c;
        }

        .my-link.my-link--danger:hover {
            color: rgba(252, 115, 109, 0.8);
        }

        .footer-fixed {
            width: 100%;
            position: fixed;
            bottom: 0;
            z-index: 2021;
        }
    </style>
</head>

<body>
    <div id="app">
        <!-- 导航栏开始 -->
        <header class="navbar tabsOn">
            <span class="logo-box">
                <img class="logo" src="images/nav_党群档案.svg" alt="">
                <p class="logo-title">庆党百年主题网</p>
            </span>
            <nav class="nav">
                <ul class="nav-links">
                    <li>
                        <a href="index.html">首页</a>
                    </li>
                    <li>
                        <a href="javascript:;">党史</a>
                    </li>
                    <li>
                        <a href="javascript:;">英雄人物</a>
                    </li>
                    <li>
                        <a href="javascript:;">经典回忆</a>
                    </li>
                    <li class="found">
                        <a href="javascript:;">发现更多</a>
                        <ol class="dropdown triangle">
                            <li><a href="photo-album.html">主题相册</a></li>
                            <li><a href="feedback.html">反馈</a></li>
                            <li><a href="about.html">关于我</a></li>
                        </ol>
                    </li>
                    <!-- 这个元素来定义滑动的线条 -->
                    <!-- <li class="underline"></li> -->
                </ul>
            </nav>
            <span class="user-box">
                <li class="">
                    <a href="javascript:;">欢迎，{{ username }}</a>
                    <ol class="dropdown">
                        <li class="active"><a href="feedback-management.html">留言管理</a></li>
                        <li><a href="javascript:;" onclick="logout()">注销</a></li>
                    </ol>
                </li>
            </span>

            <!-- <span class="cta">

                <a class="" href="register-login.html"><button>登录 / 注册</button></a>
            </span> -->
        </header>
        <!-- 导航栏结束 -->

        <!-- 网页主体开始 -->
        <main>
            <div class="container">
                <table width="100%" border="0" cellspacing="0" cellpadding="0" align="center">
                    <tr>
                        <td align="center" class="biaoti" height="60">反馈信息管理</td>
                    </tr>
                </table>

                <p id="nowTimeText" style="margin-top: 15px; text-align: right;">2021-12-25 17:41:20</p>

                <table width="100%" border="0" cellspacing="1" cellpadding="4" bgcolor="#cccccc" class="tabtop15"
                    align="center">
                    <thead>
                        <tr>
                            <td width="30%" colspan="2" class="btbg font-center titfont">反馈来源</td>
                            <td width="50%" class="btbg font-center titfont" rowspan="2">反馈内容</td>
                            <td width="10%" class="btbg font-center titfont" rowspan="2">操作</td>
                        </tr>
                        <tr>
                            <td width="10%" class="btbg font-center titfont">发布者</td>
                            <td width="20%" class="btbg font-center titfont">时间</td>
                        </tr>
                    </thead>


                    <tbody id="feedbackBox">
                        <tr>
                            <td rowspan="3" class="btbg1 font-center">Aqua99</td>
                            <td class="btbg2 font-center">2021-12-24 22:20:01</td>
                            <td>&nbsp;</td>
                            <td class="font-center">
                                <span class="my-link my-link--danger">删除</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="btbg2 font-center">2021-12-24 22:20:01</td>
                            <td>&nbsp;</td>
                            <td class="font-center">
                                <span class="my-link my-link--danger">删除</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="btbg2 font-center">2021-12-24 22:20:01</td>
                            <td>&nbsp;</td>
                            <td class="font-center">
                                <span class="my-link my-link--danger">删除</span>
                            </td>
                        </tr>
                        <tr>
                            <td rowspan="2" class="btbg1 font-center">admin</td>
                            <td class="btbg2 font-center">2021-12-24 22:20:01</td>
                            <td>&nbsp;</td>
                            <td class="font-center">
                                <span class="my-link my-link--danger">删除</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="btbg2 font-center">2021-12-24 22:20:01</td>
                            <td>&nbsp;</td>
                            <td class="font-center">
                                <span class="my-link my-link--danger">删除</span>
                            </td>
                        </tr>
                    </tbody>

                </table>

                <div id="calendar" style="position: fixed;bottom: 200px; right: 30px;"></div>
            </div>
        </main>

        <!-- 网页主体结束 -->

        <!-- 页脚信息开始 -->
        <footer id="footer" class="" style="padding-top: 15px;">
            <div
                style="background-color: #fff; border-top: 1px solid #e5e6e7;color:#747474; font-size: 14px; height: 48px; text-align: center; line-height: 48px;">
                <span>Copyright © 2020-2021 &nbsp;&nbsp;&nbsp;&nbsp;</span>
                <span>备案号：桂ICP备20xxxx1234号-1</span>
            </div>

        </footer>
        <!-- 页脚信息结束 -->
    </div>

    <script src="./js/lib/vue2.js"></script>

    <script>
        // 日期格式化，挂载到Date原型链
        Date.prototype.format = function (fmt) {
            var o = {
                "M+": this.getMonth() + 1,                 //月份
                "d+": this.getDate(),                    //日
                "h+": this.getHours(),                   //小时
                "m+": this.getMinutes(),                 //分
                "s+": this.getSeconds(),                 //秒
                "q+": Math.floor((this.getMonth() + 3) / 3), //季度
                "S": this.getMilliseconds()             //毫秒
            };
            if (/(y+)/.test(fmt)) {
                fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
            }
            for (var k in o) {
                if (new RegExp("(" + k + ")").test(fmt)) {
                    fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
                }
            }
            return fmt;
        }

        function nowTime() {
            document.getElementById('nowTimeText').innerHTML = new Date().format("yyyy-MM-dd hh:mm:ss");
        }

        setInterval("nowTime()", 1000)

        const logout = () => {
            localStorage.clear();
            window.location.href = "index.html"
        }

        // 调整网页底部信息栏位置。
        let footerDom = document.querySelector('#footer');
        function footerInit() {
            let viewPort = document.documentElement.clientHeight;
            let footerOffsetTop = footerDom.offsetTop;
            // 如果元素距离顶部高度加上它自身的高度小于网页可视高度，则将其固定在网页底部
            if (footerOffsetTop + footerDom.style.height < viewPort) {
                footerDom.classList.add('footer-fixed');
            } else {
                footerDom.classList.remove('footer-fixed');
            }
        }

        window.onload = footerInit()

        // 删除留言
        function deleteFeedback(id) {
            let feedbackList = localStorage.getItem('feedback')
                ? JSON.parse(localStorage.getItem('feedback'))
                : '';

            for (let i = 0; i < feedbackList.length; i++) {
                if (feedbackList[i].id === id) {
                    feedbackList.splice(i, 1);
                    break;
                }
            }
            localStorage.setItem('feedback', JSON.stringify(feedbackList));
            // 初始化表格数据
            initTableData()
        }

        function test() {
            let feedbackObj = [
                {
                    'id': 1,
                    'username': 'Aqua99',
                    'time': '2022-10-11 23:11:01',
                    'msg': '哈哈'
                },
                {
                    'id': 2,
                    'username': 'Aqua99',
                    'time': '2022-10-11 23:11:01',
                    'msg': '嗯嗯'
                },
                {
                    'id': 3,
                    'username': 'admin',
                    'time': '2022-10-11 23:11:01',
                    'msg': '嗯嗯'
                },
                {
                    'id': 4,
                    'username': 'yzm',
                    'time': '2022-10-11 23:11:01',
                    'msg': '你懂啥'
                },
                {
                    'id': 5,
                    'username': 'yzm',
                    'time': '2022-10-11 23:11:01',
                    'msg': '再看看你懂啥'
                }
            ]

            localStorage.setItem('feedback', JSON.stringify(feedbackObj))
        }

        test();

        // 初始化表格数据方法
        function initTableData() {
            let data = initLocalData();
            let feedbackDom = document.getElementById('feedbackBox');
            let feedbackHtml = ''
            // 遍历map容器
            data.forEach((value, key, map) => {
                for (let i = 0, flag = true; i < value.length; i++) {
                    feedbackHtml += '<tr>';
                    if (flag) {
                        feedbackHtml += `<td class="btbg1 font-center" rowspan="${value.length}">${key}</td>`;
                        flag = false;
                    }
                    feedbackHtml += `<td class="btbg2 font-center">${value[i].time}</td>`;
                    feedbackHtml += `<td class="font-center">${value[i].msg}</td>`;
                    feedbackHtml += `<td class="font-center"><span class="my-link my-link--danger" onclick="deleteFeedback(${value[i].id} )"><i class="iconfont icon-delete"></i>&nbsp;删除</span></td>`;
                    feedbackHtml += '</tr>';
                }
            })

            feedbackDom.innerHTML = feedbackHtml
        }
        initTableData()


        // 处理localStorage存储的数据，整理成map结构，用户名映射反馈的信息列表
        function initLocalData() {
            let feedbackList = localStorage.getItem('feedback')
                ? JSON.parse(localStorage.getItem('feedback'))
                : '';
            let userMap = new Map();
            for (let i = 0; i < feedbackList.length; i++) {
                if (userMap.get(feedbackList[i].username)) {
                    userMap.get(feedbackList[i].username).push(feedbackList[i]);
                } else {
                    userMap.set(feedbackList[i].username, [])
                    userMap.get(feedbackList[i].username).push(feedbackList[i]);
                }
            }
            // console.log(userMap);
            return userMap;
        }

    </script>

    <script>
        var vm = new Vue({
            el: '#app',
            data: {
                activeIndex: '1',
                username: 'Aqua99'
            }
        })
    </script>


</body>

</html>
